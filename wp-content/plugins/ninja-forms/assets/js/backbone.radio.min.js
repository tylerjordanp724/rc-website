!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],n):e.Backbone.Radio=n(e._,e.Backbone)}(this,(function(e,n){"use strict";function t(e,n,t,r){var s=e[n];return t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context?void 0:(delete e[n],!0)}function r(n,r,s,i){n||(n={});for(var u=r?[r]:e.keys(n),a=!1,o=0,c=u.length;c>o;o++)n[r=u[o]]&&t(n,r,s,i)&&(a=!0);return a}function s(n){return c[n]||(c[n]=e.partial(a.log,n))}function i(n){return e.isFunction(n)?n:function(){return n}}var u=n.Radio,a=n.Radio={};a.VERSION="1.0.1",a.noConflict=function(){return n.Radio=u,this},a.DEBUG=!1,a._debugText=function(e,n,t){return e+(t?" on the "+t+" channel":"")+': "'+n+'"'},a.debugLog=function(e,n,t){a.DEBUG&&console&&console.warn&&console.warn(a._debugText(e,n,t))};var o=/\s+/;a._eventsApi=function(n,t,r,s){if(!r)return!1;var i={};if("object"==typeof r){for(var u in r){var a=n[t].apply(n,[u,r[u]].concat(s));o.test(u)?e.extend(i,a):i[u]=a}return i}if(o.test(r)){for(var c=r.split(o),l=0,h=c.length;h>l;l++)i[c[l]]=n[t].apply(n,[c[l]].concat(s));return i}return!1},a._callHandler=function(e,n,t){var r=t[0],s=t[1],i=t[2];switch(t.length){case 0:return e.call(n);case 1:return e.call(n,r);case 2:return e.call(n,r,s);case 3:return e.call(n,r,s,i);default:return e.apply(n,t)}};var c={};e.extend(a,{log:function(n,t){var r=e.rest(arguments,2);console.log("["+n+'] "'+t+'"',r)},tuneIn:function(e){var n=a.channel(e);return n._tunedIn=!0,n.on("all",s(e)),this},tuneOut:function(e){var n=a.channel(e);return n._tunedIn=!1,n.off("all",s(e)),delete c[e],this}}),a.Requests={request:function(n){var t=e.rest(arguments),r=a._eventsApi(this,"request",n,t);if(r)return r;var s=this.channelName,i=this._requests;if(s&&this._tunedIn&&a.log.apply(this,[s,n].concat(t)),i&&(i[n]||i.default)){var u=i[n]||i.default;return t=i[n]?t:arguments,a._callHandler(u.callback,u.context,t)}a.debugLog("An unhandled request was fired",n,s)},reply:function(e,n,t){return a._eventsApi(this,"reply",e,[n,t])||(this._requests||(this._requests={}),this._requests[e]&&a.debugLog("A request was overwritten",e,this.channelName),this._requests[e]={callback:i(n),context:t||this}),this},replyOnce:function(n,t,r){if(a._eventsApi(this,"replyOnce",n,[t,r]))return this;var s=this,u=e.once((function(){return s.stopReplying(n),i(t).apply(this,arguments)}));return this.reply(n,u,r)},stopReplying:function(e,n,t){return a._eventsApi(this,"stopReplying",e)||(e||n||t?r(this._requests,e,n,t)||a.debugLog("Attempted to remove the unregistered request",e,this.channelName):delete this._requests),this}},a._channels={},a.channel=function(e){if(!e)throw new Error("You must provide a name for the channel.");return a._channels[e]?a._channels[e]:a._channels[e]=new a.Channel(e)},a.Channel=function(e){this.channelName=e},e.extend(a.Channel.prototype,n.Events,a.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var l,h,f=[n.Events,a.Commands,a.Requests];return e.each(f,(function(n){e.each(n,(function(n,t){a[t]=function(n){return h=e.rest(arguments),(l=this.channel(n))[t].apply(l,h)}}))})),a.reset=function(n){var t=n?[this._channels[n]]:this._channels;e.invoke(t,"reset")},a}));