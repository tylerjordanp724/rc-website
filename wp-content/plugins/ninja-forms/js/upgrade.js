jQuery(document).ready((function(e){({forms:[],step:"checking",container:"#nfUpgradeApp",tmpl:{test:wp.template("test"),table:wp.template("table"),legend:wp.template("legend")},formCheckPointer:0,formConvertPointer:0,updateTable:function(){var e={title:"",headers:["Title","Status"],rows:this.forms,step:this.step,showSupportLink:0};if("checking"==this.step&&(e.title="Form Upgrade List",e.legend=this.tmpl.legend({no_issues_detected:"No Issues Detected",will_need_attention:"Will Need Attention After Upgrade"}),e.next="Start Upgrade",e.readyToConvert=1,_.each(this.forms,(function(t){t.checked||(e.readyToConvert=0)}),this)),"converting"==this.step){e.title="Converting Forms";var t=1;_.each(this.forms,(function(n){n.converted||(t=0),n.failed&&(e.showSupportLink=1)}),this),t&&(jQuery(window).unbind("beforeunload"),window.location.href=nfThreeUpgrade.redirectURL)}jQuery(this.container).html(this.tmpl.table(e))},checkForms:function(){var e=this.forms[this.formCheckPointer]||null;e&&this.checkForm(e),this.formCheckPointer++},checkForm:function(t){var n=this;e.post(ajaxurl,{action:"ninja_forms_upgrade_check",formID:t.id},(function(e){var o=e.canUpgrade?"":"flag",r=e.canUpgrade?0:1;n.updateForm(t.id,"title",e.title),n.updateForm(t.id,"icon",o),n.updateForm(t.id,"checked",!0),n.updateForm(t.id,"flagged",r),n.updateTable(),n.checkForms()}),"json")},updateForm:function(e,t,n){_.each(this.forms,(function(o){e==o.id&&(o[t]=n)}))},start:function(){_.each(nfThreeUpgrade.forms,(function(e){this.forms.push({id:e,title:"",icon:"update",checked:!1,converted:!1,failed:!1})}),this),this.checkForms(),this.updateTable();var e=this;jQuery("#nfUpgradeApp").on("click",".js-nfUpgrade-startConversion",(function(){e.startConversion(e)}))},startConversion:function(t){console.log("HERE"),console.log(t),t.step="converting",jQuery(window).bind("beforeunload",(function(){return"You have unsaved changes."})),e.post(ajaxurl,{nf2to3:1,action:"ninja_forms_ajax_migrate_database",security:nfThreeUpgrade.nonce},(function(n){e.post(ajaxurl,{action:"nfThreeUpgrade_GetSerializedFields"},(function(n){e.post(ajaxurl,{nf2to3:1,fields:n.serialized,action:"ninja_forms_ajax_import_fields",security:nfThreeUpgrade.nonce},(function(e){t.convertForms()}),"json")}),"json")}))},convertForms:function(){var e=this.forms[this.formConvertPointer]||null;e&&this.convertForm(e),this.formConvertPointer++},convertForm:function(t){var n=this;console.log("Converting..."),console.log(t),t.icon="update",n.updateTable(),e.post(ajaxurl,{action:"nfThreeUpgrade_GetSerializedForm",formID:t.id},(function(o){e.post(ajaxurl,{nf2to3:1,action:"ninja_forms_ajax_import_form",security:nfThreeUpgrade.nonce,formID:t.id,import:o.serialized,flagged:t.flagged},(function(e){t.converted=!0,t.icon="yes",n.updateTable()}),"json").fail((function(){t.converted=!1,t.failed=!0,t.icon="no",n.updateTable()})).always((function(){n.convertForms()}))}),"json")}}).start()}));